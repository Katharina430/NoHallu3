<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>No Hallu - AI ë¬¸í—Œ ê²€ì¦ ë„êµ¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            max-width: 900px;
            width: 100%;
            padding: 40px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            color: #333;
            margin-bottom: 10px;
            font-weight: 700;
        }
        
        .header p {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .header .subtitle {
            color: #667eea;
            font-size: 0.9rem;
            font-style: italic;
        }

        .version-info {
            background: #e0f2fe;
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 0.9rem;
            color: #0369a1;
        }
        
        .input-section {
            margin-bottom: 30px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 10px;
            color: #555;
            font-weight: 500;
        }
        
        .citation-input {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            resize: vertical;
            font-family: 'Courier New', monospace;
            transition: border-color 0.3s;
            line-height: 1.6;
        }
        
        .citation-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .btn {
            flex: 1;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #666;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .results {
            display: none;
        }
        
        .summary-box {
            background: #f0f4ff;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 2px solid #667eea;
        }
        
        .summary-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
        }
        
        .summary-content {
            font-size: 1.1rem;
            line-height: 1.6;
        }
        
        .suspicious-found {
            color: #c53030;
            font-weight: 600;
        }
        
        .all-clear {
            color: #276749;
            font-weight: 600;
        }
        
        .result-item {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #667eea;
            position: relative;
        }
        
        .result-item.suspicious {
            border-left-color: #f56565;
            background: #fff5f5;
        }

        .result-item.invalid-journal {
            border-left-color: #dc2626;
            background: #fef2f2;
        }
        
        .result-item.checking {
            border-left-color: #fbbf24;
            background: #fffbeb;
        }
        
        .result-number {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #e0e0e0;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
        }
        
        .result-title {
            font-weight: 600;
            margin-bottom: 12px;
            color: #333;
            padding-right: 50px;
        }
        
        .search-link {
            display: inline-block;
            margin-top: 12px;
            padding: 8px 16px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .search-link:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }
        
        .status-badge {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .badge-suspicious {
            background: #fed7d7;
            color: #c53030;
        }

        .badge-invalid {
            background: #fecaca;
            color: #dc2626;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #667eea;
            width: 0%;
            transition: width 0.3s;
        }
        
        .loading-text {
            color: #666;
            margin-top: 15px;
        }
        
        .tips {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }
        
        .tips h3 {
            color: #4a5568;
            margin-bottom: 10px;
        }
        
        .tips p {
            color: #718096;
            line-height: 1.8;
        }

        .journal-check-info {
            background: #f0fdf4;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 14px;
            border: 1px solid #86efac;
        }

        .journal-check-info.invalid {
            background: #fef2f2;
            border: 1px solid #fca5a5;
        }

        .file-input-section {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
            border: 1px dashed #cbd5e1;
        }

        .file-input-section label {
            font-size: 0.9rem;
            color: #64748b;
        }

        .db-status {
            font-size: 0.85rem;
            color: #059669;
            margin-top: 8px;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 25px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>No Hallu ğŸ”</h1>
            <p>AIê°€ ìƒì„±í•œ ê°€ì§œ ë¬¸í—Œì„ ê²€ì¦í•˜ëŠ” êµì‚¬ìš© ë„êµ¬</p>
            <p class="subtitle">"í•˜ë‚˜ì˜ ê°€ì§œ ë¬¸í—Œë§Œ ì°¾ì•„ë„ ì„±ê³µ!"</p>
        </div>

        <div class="version-info">
            âœ¨ <strong>v2.0</strong> â€” 2025ë…„ 12ì›” 14ì¼ í•™ìˆ ì§€ DB ì—…ë°ì´íŠ¸
        </div>

        <div class="file-input-section">
            <label>ğŸ“š í•™ìˆ ì§€ DB íŒŒì¼ (CSV):</label>
            <input type="file" id="journalDbFile" accept=".csv" style="margin-top: 8px;">
            <div class="db-status" id="dbStatus">ê¸°ë³¸ DB ì‚¬ìš© ì¤‘</div>
        </div>
        
        <div class="input-section">
            <label class="input-label">í•™ìƒì´ ì œì¶œí•œ ì°¸ê³ ë¬¸í—Œ ì „ì²´ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”:</label>
            <textarea 
                class="citation-input" 
                id="citationInput"
                placeholder="ì°¸ê³ ë¬¸í—Œì„ ì—¬ê¸°ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.&#10;&#10;í•œ ì¤„ì— í•˜ë‚˜ì”©, ë˜ëŠ” ì „ì²´ë¥¼ ê·¸ëŒ€ë¡œ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."
            ></textarea>
        </div>
        
        <div class="button-group">
            <button class="btn btn-primary" onclick="checkAllCitations()">
                ğŸ” ê²€ì¦ ì‹œì‘
            </button>
            <button class="btn btn-secondary" onclick="clearInput()">ì§€ìš°ê¸°</button>
        </div>
        
        <div class="loading" id="loading">
            <p style="font-size: 1.1rem; font-weight: 600; margin-bottom: 20px;">
                ë¬¸í—Œì„ ê²€ì¦í•˜ê³  ìˆìŠµë‹ˆë‹¤...
            </p>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <p class="loading-text" id="loadingText">0/0 ê²€ì‚¬ ì¤‘...</p>
        </div>
        
        <div class="results" id="results">
            <div class="summary-box" id="summaryBox"></div>
            <h3 style="margin-bottom: 20px;">ìƒì„¸ ê²€ì¦ ê²°ê³¼:</h3>
            <div id="resultsList"></div>
        </div>
        
        <div class="tips">
            <h3>ğŸ’¡ ì‚¬ìš© ì•ˆë‚´</h3>
            <p>ì°¸ê³ ë¬¸í—Œ ì „ì²´ë¥¼ ìœ„ ì…ë ¥ì°½ì— ë¶™ì—¬ë„£ê³  "ê²€ì¦ ì‹œì‘" ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”. 
            ê° ë¬¸í—Œì— ëŒ€í•´ Google ë° Google Scholar ê²€ìƒ‰ ë§í¬ê°€ ì œê³µë©ë‹ˆë‹¤.</p>
        </div>
    </div>
    
    <script>
        /* ============================================================
         * ğŸ“š í•œêµ­ ë“±ì¬ í•™ìˆ ì§€ ëª©ë¡
         * 
         * ì´ ëª©ë¡ì„ ì—…ë°ì´íŠ¸í•˜ë ¤ë©´:
         * 1. í•œêµ­ì—°êµ¬ì¬ë‹¨ì—ì„œ ìµœì‹  í•™ìˆ ì§€ ëª©ë¡ì„ ë‹¤ìš´ë¡œë“œ
         * 2. ì•„ë˜ Set ì•ˆì˜ ë‚´ìš©ì„ êµì²´
         * 3. í˜•ì‹: "í•™ìˆ ì§€ëª…", (ì‰¼í‘œë¡œ êµ¬ë¶„, í°ë”°ì˜´í‘œ ì‚¬ìš©)
         * 
         * ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025ë…„ 12ì›” 14ì¼ (2,886ê°œ)
         * ============================================================ */
        let validKoreanJournals = new Set([
            // CSV íŒŒì¼ ë¡œë“œ ì‹œ ë™ì ìœ¼ë¡œ ì±„ì›Œì§
            // GitHub ë°°í¬ ì‹œì—ëŠ” ì—¬ê¸°ì— ì§ì ‘ í•™ìˆ ì§€ëª…ì„ ë‚˜ì—´í•˜ì„¸ìš”
        ]);

        // CSV íŒŒì¼ì—ì„œ í•™ìˆ ì§€ ëª©ë¡ ë¡œë“œ
        document.getElementById('journalDbFile').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;

            try {
                const text = await file.text();
                const lines = text.split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0);
                
                validKoreanJournals = new Set(lines);
                document.getElementById('dbStatus').textContent = 
                    `âœ… ${validKoreanJournals.size}ê°œ í•™ìˆ ì§€ ë¡œë“œ ì™„ë£Œ`;
            } catch (error) {
                document.getElementById('dbStatus').textContent = 
                    `âŒ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨: ${error.message}`;
            }
        });

        // ì˜ì‹¬ìŠ¤ëŸ¬ìš´ íŒ¨í„´ ë°ì´í„°ë² ì´ìŠ¤
        const suspiciousPatterns = {
            // ê°€ì§œ í•™ìˆ ì§€ íŒ¨í„´ (ì‹¤ì œë¡œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¡°í•©)
            fakeJournals: [
                /^AIì™€\s/,
                /^ë¹…ë°ì´í„°ì™€\s/,
                /^4ì°¨ì‚°ì—…í˜ëª…/,
                /ì™€ ë¯¸ë˜$/,
                /ì™€ ì‚¬íšŒ$/,
                /ì™€ ì¸ê°„$/,
                /^ë””ì§€í„¸\s.*í•™íšŒì§€$/,
                /^ë¯¸ë˜\s.*ì—°êµ¬$/,
                /^í˜ì‹ \s.*ì €ë„$/,
                /^í•œêµ­AI/,
                /^í˜„ëŒ€.*í•™íšŒì§€$/
            ],
            // ë¼ìš´ë“œ ë„˜ë²„ í˜ì´ì§€ (AIê°€ ìì£¼ ìƒì„±í•˜ëŠ” íŒ¨í„´)
            roundPageNumbers: [
                /,\s*1-25\.?$/,
                /,\s*1-50\.?$/,
                /,\s*50-100\.?$/,
                /,\s*100-150\.?$/,
                /,\s*1-100\.?$/,
                /,\s*100-200\.?$/
            ],
            // ì¼ë ¨ë²ˆí˜¸ íŒ¨í„´ (MLA/APA/Chicagoì—ëŠ” ì—†ìŒ)
            serialNumbers: [
                /^\d+\.\s/,      // "1. "
                /^\d+\)\s/,      // "1) "
                /^\[\d+\]\s/,    // "[1] "
                /^\(\d+\)\s/     // "(1) "
            ]
        };
        
        function extractCitationInfo(citation) {
            let cleanCitation = citation.trim();
            
            // ì¼ë ¨ë²ˆí˜¸ ì œê±° ì „ì— ì¡´ì¬ ì—¬ë¶€ í™•ì¸
            let hasSerialNumber = suspiciousPatterns.serialNumbers.some(p => p.test(cleanCitation));
            
            // ì¼ë ¨ë²ˆí˜¸ ì œê±°
            cleanCitation = cleanCitation
                .replace(/^\d+[\.\)]\s*/, '')
                .replace(/^\[\d+\]\s*/, '')
                .replace(/^\(\d+\)\s*/, '');
            
            // ì—°ë„ ì¶”ì¶œ
            const yearMatch = cleanCitation.match(/\((\d{4})\)/);
            const year = yearMatch ? yearMatch[1] : null;
            
            // ì €ìëª… ì¶”ì¶œ
            const authorMatch = cleanCitation.match(/^([ê°€-í£A-Za-z\s,&Â·]+)(?=\s*[\(\.])/);
            const author = authorMatch ? authorMatch[1].trim() : null;
            
            // í•™ìˆ ì§€ëª… ì¶”ì¶œ
            let journal = null;
            const journalPatterns = [
                /ã€([^ã€]+)ã€/,
                /\.\s*([ê°€-í£]+(?:í•™íšŒì§€|ì—°êµ¬|í•™ë³´|ë…¼ì´|ë…¼ë¬¸ì§‘|í•™ì§€))/,
                /,\s*([ê°€-í£]+(?:í•™íšŒì§€|ì—°êµ¬|í•™ë³´|ë…¼ì´|ë…¼ë¬¸ì§‘|í•™ì§€))/,
                /\.\s*([A-Z][A-Za-z\s&]+(?:Journal|Review|Studies|Research))/i
            ];
            
            for (const pattern of journalPatterns) {
                const match = cleanCitation.match(pattern);
                if (match) {
                    journal = match[1].trim();
                    break;
                }
            }
            
            // ì œëª© ì¶”ì¶œ
            let title = null;
            const titlePatterns = [
                /[ã€Œ""]([^ã€""]+)[ã€""]/,
                /\d{4}\)\.\s*([^.]+?)(?:\.|,|\s*[ê°€-í£]+:|$)/,
                /\)\.\s*([^.]+?)\.\s*(?:ì„œìš¸|ë¶€ì‚°|ëŒ€êµ¬|ì¸ì²œ|ê´‘ì£¼|ëŒ€ì „|ìš¸ì‚°|ê²½ê¸°|ê°•ì›|ì¶©ë¶|ì¶©ë‚¨|ì „ë¶|ì „ë‚¨|ê²½ë¶|ê²½ë‚¨|ì œì£¼|ì¶œíŒ|:)/
            ];
            
            for (const pattern of titlePatterns) {
                const match = cleanCitation.match(pattern);
                if (match) {
                    title = match[1].trim();
                    break;
                }
            }
            
            // ê²€ìƒ‰ì–´ ìƒì„±
            let searchQuery = '';
            if (title) {
                searchQuery = `${title} ${author || ''} ${year || ''}`.trim();
            } else if (author && year) {
                searchQuery = `${author} ${year}`;
            } else {
                searchQuery = cleanCitation
                    .replace(/\([^)]*\)/g, ' ')
                    .replace(/[ã€ã€ã€Œã€""]/g, ' ')
                    .replace(/\s+/g, ' ')
                    .substring(0, 100)
                    .trim();
            }
            
            return { 
                author, 
                year, 
                title,
                journal,
                hasSerialNumber,
                original: citation.trim(),
                searchQuery
            };
        }
        
        function analyzeCitation(citationInfo, allYears) {
            let suspicionLevel = 0;
            let reasons = [];
            
            // 1. í•™ìˆ ì§€ ê²€ì¦ (ê°€ì¥ ì¤‘ìš”)
            if (citationInfo.journal) {
                const isValidJournal = validKoreanJournals.size > 0 && 
                                       validKoreanJournals.has(citationInfo.journal);
                
                if (!isValidJournal && validKoreanJournals.size > 0) {
                    // ê°€ì§œ í•™ìˆ ì§€ íŒ¨í„´ í™•ì¸
                    let isFakePattern = suspiciousPatterns.fakeJournals.some(
                        p => p.test(citationInfo.journal)
                    );
                    
                    if (isFakePattern) {
                        suspicionLevel += 60;
                        reasons.push(`ì˜ì‹¬ìŠ¤ëŸ¬ìš´ í•™ìˆ ì§€ëª…: "${citationInfo.journal}"`);
                    } else if (/ì—°êµ¬|í•™íšŒì§€|í•™ë³´|ë…¼ì´/.test(citationInfo.journal)) {
                        suspicionLevel += 50;
                        reasons.push(`ë¯¸ë“±ì¬ í•™ìˆ ì§€: "${citationInfo.journal}"`);
                    }
                }
            }
            
            // 2. ë¼ìš´ë“œ ë„˜ë²„ í˜ì´ì§€
            const hasRoundPage = suspiciousPatterns.roundPageNumbers.some(
                p => p.test(citationInfo.original)
            );
            if (hasRoundPage) {
                suspicionLevel += 15;
                reasons.push("ì •í˜•í™”ëœ í˜ì´ì§€ ë²ˆí˜¸");
            }
            
            // 3. ì—°ë„ ê²€ì‚¬
            if (citationInfo.year) {
                const year = parseInt(citationInfo.year);
                const currentYear = new Date().getFullYear();
                
                if (year > currentYear) {
                    suspicionLevel += 50;
                    reasons.push("ë¯¸ë˜ ì—°ë„");
                } else if (year === currentYear) {
                    suspicionLevel += 10;
                    reasons.push(`${currentYear}ë…„ ìµœì‹  ìë£Œ`);
                }
            }
            
            return {
                suspicionLevel,
                reasons,
                isSuspicious: suspicionLevel >= 40,
                isInvalidJournal: citationInfo.journal && 
                                  validKoreanJournals.size > 0 && 
                                  !validKoreanJournals.has(citationInfo.journal)
            };
        }

        function analyzeYearDistribution(citations) {
            const years = citations
                .map(c => c.year)
                .filter(y => y)
                .map(y => parseInt(y));
            
            if (years.length < 3) return null;
            
            const currentYear = new Date().getFullYear();
            const recentYears = years.filter(y => y >= currentYear - 5);
            const recentRatio = recentYears.length / years.length;
            
            // 80% ì´ìƒì´ ìµœê·¼ 5ë…„ ë‚´ ë¬¸í—Œì´ë©´ ê²½ê³ 
            if (recentRatio >= 0.8) {
                return {
                    warning: true,
                    message: `ì°¸ê³ ë¬¸í—Œì˜ ${Math.round(recentRatio * 100)}%ê°€ ìµœê·¼ 5ë…„ ë‚´ ì¶œíŒë¬¼ì…ë‹ˆë‹¤.`
                };
            }
            return null;
        }

        function analyzeSerialNumberUsage(citations) {
            const withSerial = citations.filter(c => c.hasSerialNumber).length;
            const ratio = withSerial / citations.length;
            
            // 50% ì´ìƒì´ ì¼ë ¨ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•˜ë©´ ê²½ê³ 
            if (ratio >= 0.5 && withSerial >= 3) {
                return {
                    warning: true,
                    message: `ì°¸ê³ ë¬¸í—Œì— ì¼ë ¨ë²ˆí˜¸(1., 2., ...)ê°€ ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. MLA/APA/Chicago ì–‘ì‹ì—ì„œëŠ” ì¼ë ¨ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.`
                };
            }
            return null;
        }
        
        async function checkAllCitations() {
            const input = document.getElementById('citationInput').value.trim();
            if (!input) {
                alert('ì°¸ê³ ë¬¸í—Œì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            // ë¬¸í—Œ ë¶„ë¦¬
            let citations = input.split(/\n+/)
                .map(line => line.trim())
                .filter(line => line && line.length > 10);
            
            if (citations.length === 0) {
                alert('ìœ íš¨í•œ ì°¸ê³ ë¬¸í—Œì´ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // UI ì´ˆê¸°í™”
            document.getElementById('loading').style.display = 'block';
            document.getElementById('results').style.display = 'none';
            
            const progressFill = document.getElementById('progressFill');
            const loadingText = document.getElementById('loadingText');
            
            // ë¬¸í—Œ ì •ë³´ ì¶”ì¶œ
            const citationInfos = citations.map(c => extractCitationInfo(c));
            
            // ì „ì²´ íŒ¨í„´ ë¶„ì„
            const yearDistribution = analyzeYearDistribution(citationInfos);
            const serialNumberUsage = analyzeSerialNumberUsage(citationInfos);
            
            // ê²°ê³¼ ì €ì¥
            const results = [];
            let suspiciousCount = 0;
            let invalidJournalCount = 0;
            
            // ê° ë¬¸í—Œ ê²€ì‚¬
            for (let i = 0; i < citationInfos.length; i++) {
                const progress = ((i + 1) / citationInfos.length) * 100;
                progressFill.style.width = `${progress}%`;
                loadingText.textContent = `${i + 1}/${citationInfos.length} ê²€ì‚¬ ì¤‘...`;
                
                const analysis = analyzeCitation(citationInfos[i], citationInfos.map(c => c.year));
                
                if (analysis.isSuspicious) suspiciousCount++;
                if (analysis.isInvalidJournal) invalidJournalCount++;
                
                results.push({
                    ...citationInfos[i],
                    ...analysis,
                    index: i + 1
                });
                
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            // ê²°ê³¼ í‘œì‹œ
            displayResults(results, suspiciousCount, invalidJournalCount, 
                          yearDistribution, serialNumberUsage);
            
            document.getElementById('loading').style.display = 'none';
            document.getElementById('results').style.display = 'block';
        }
        
        function displayResults(results, suspiciousCount, invalidJournalCount, 
                               yearDist, serialNum) {
            const summaryBox = document.getElementById('summaryBox');
            
            let additionalWarnings = '';
            if (yearDist?.warning) {
                additionalWarnings += `<br>âš ï¸ ${yearDist.message}`;
            }
            if (serialNum?.warning) {
                additionalWarnings += `<br>âš ï¸ ${serialNum.message}`;
            }
            
            const hasWarnings = suspiciousCount > 0 || yearDist?.warning || serialNum?.warning;
            
            if (hasWarnings) {
                summaryBox.innerHTML = `
                    <div class="summary-title">ğŸš¨ ê²€ì¦ ì™„ë£Œ</div>
                    <div class="summary-content">
                        ì´ <strong>${results.length}ê°œ</strong> ë¬¸í—Œ ê²€ì‚¬ ì™„ë£Œ.
                        ${suspiciousCount > 0 ? `<br><span class="suspicious-found">${suspiciousCount}ê°œì˜ ì˜ì‹¬ìŠ¤ëŸ¬ìš´ ë¬¸í—Œ</span> ë°œê²¬.` : ''}
                        ${invalidJournalCount > 0 ? `<br><span class="suspicious-found">${invalidJournalCount}ê°œëŠ” ë¯¸ë“±ì¬/ë¯¸í™•ì¸ í•™ìˆ ì§€.</span>` : ''}
                        ${additionalWarnings}
                    </div>
                `;
            } else {
                summaryBox.innerHTML = `
                    <div class="summary-title">âœ… ê²€ì¦ ì™„ë£Œ</div>
                    <div class="summary-content">
                        ì´ <strong>${results.length}ê°œ</strong> ë¬¸í—Œì„ ê²€ì‚¬í–ˆìŠµë‹ˆë‹¤.
                        <span class="all-clear">ì˜ì‹¬ íŒ¨í„´ì´ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</span><br><br>
                        ì•„ë˜ ê²€ìƒ‰ ë§í¬ë¡œ ì¶”ê°€ í™•ì¸ì„ ê¶Œì¥í•©ë‹ˆë‹¤.
                    </div>
                `;
            }
            
            // ìƒì„¸ ê²°ê³¼ í‘œì‹œ
            const resultsList = document.getElementById('resultsList');
            resultsList.innerHTML = '';
            
            results.forEach(result => {
                const resultDiv = document.createElement('div');
                
                let className = 'result-item';
                if (result.isInvalidJournal) {
                    className += ' invalid-journal';
                } else if (result.isSuspicious) {
                    className += ' suspicious';
                }
                
                resultDiv.className = className;
                
                const googleUrl = `https://www.google.com/search?q=${encodeURIComponent(result.searchQuery)}`;
                const scholarUrl = `https://scholar.google.com/scholar?q=${encodeURIComponent(result.searchQuery)}`;
                
                let journalInfo = '';
                if (result.journal) {
                    const isValid = validKoreanJournals.size > 0 && 
                                   validKoreanJournals.has(result.journal);
                    journalInfo = `
                        <div class="journal-check-info ${isValid ? '' : 'invalid'}">
                            ğŸ“š í•™ìˆ ì§€: "${result.journal}" ${isValid ? 'âœ… ë“±ì¬ í™•ì¸' : 'âŒ ë¯¸ë“±ì¬/ë¯¸í™•ì¸'}
                        </div>
                    `;
                }
                
                resultDiv.innerHTML = `
                    <div class="result-number">${result.index}</div>
                    <div class="result-title">${result.original}</div>
                    ${journalInfo}
                    ${result.reasons.length ? `
                        <div style="color: #666; margin: 10px 0; font-size: 14px;">
                            âš ï¸ ${result.reasons.join(', ')}
                        </div>
                    ` : ''}
                    <div style="margin-top: 12px;">
                        <a href="${googleUrl}" target="_blank" class="search-link">
                            ğŸ” Google ê²€ìƒ‰
                        </a>
                        <a href="${scholarUrl}" target="_blank" class="search-link" style="margin-left: 10px;">
                            ğŸ“ Scholar ê²€ìƒ‰
                        </a>
                        ${result.isInvalidJournal ? '<span class="status-badge badge-invalid">ë¯¸ë“±ì¬ í•™ìˆ ì§€</span>' : 
                          result.isSuspicious ? '<span class="status-badge badge-suspicious">ì˜ì‹¬</span>' : ''}
                    </div>
                `;
                
                resultsList.appendChild(resultDiv);
            });
        }
        
        function clearInput() {
            document.getElementById('citationInput').value = '';
            document.getElementById('results').style.display = 'none';
        }
        
        document.getElementById('citationInput').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                checkAllCitations();
            }
        });
    </script>
</body>
</html>
