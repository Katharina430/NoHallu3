<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë“±ì¬ í•™ìˆ ì§€ ë°ì´í„° ì²˜ë¦¬</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <style>
        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .info-box {
            background: #667eea;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        #journalList {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background: #f9f9f9;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin: 20px 0;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        #codeOutput {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px 0;
        }
        .copy-btn:hover {
            background: #5a67d8;
        }
        .search-box {
            display: flex;
            gap: 10px;
            margin: 20px 0;
        }
        .search-input {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š ë“±ì¬ í•™ìˆ ì§€ ë°ì´í„° ì²˜ë¦¬ê¸°</h1>
        
        <div class="info-box">
            <h2>CSV íŒŒì¼ ë¶„ì„ ì¤‘...</h2>
            <p>kjournal202501.csv íŒŒì¼ì„ ì²˜ë¦¬í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
        </div>

        <div id="stats" class="stats"></div>

        <div class="search-box">
            <input type="text" id="searchInput" class="search-input" placeholder="í•™ìˆ ì§€ëª… ê²€ìƒ‰ (ì˜ˆ: êµ­ì–´)">
            <button class="copy-btn" onclick="searchJournals()">ê²€ìƒ‰</button>
        </div>

        <div id="journalList"></div>

        <h3>ğŸ”§ NoHallu í†µí•© ì½”ë“œ</h3>
        <button class="copy-btn" onclick="copyCode()">ğŸ“‹ ì½”ë“œ ë³µì‚¬í•˜ê¸°</button>
        <div id="codeOutput"></div>
    </div>

    <script>
        let allJournals = [];
        let validJournalsSet = null;

        async function loadJournalData() {
            try {
                // CSV íŒŒì¼ ì½ê¸°
                const csvContent = await window.fs.readFile('kjournal202501.csv', { encoding: 'utf8' });
                
                // PapaParseë¡œ CSV íŒŒì‹±
                const results = Papa.parse(csvContent, {
                    header: true,
                    skipEmptyLines: true,
                    encoding: 'UTF-8'
                });
                
                // ì²« ë²ˆì§¸ ì»¬ëŸ¼ì˜ í‚¤ ì°¾ê¸°
                const firstKey = Object.keys(results.data[0])[0];
                
                // í•™ìˆ ì§€ëª… ì¶”ì¶œ
                allJournals = results.data
                    .map(row => row[firstKey])
                    .filter(name => name && name.trim())
                    .map(name => name.trim());
                
                // ì¤‘ë³µ ì œê±°
                const uniqueJournals = [...new Set(allJournals)];
                
                // Set ìƒì„± (ë¹ ë¥¸ ê²€ìƒ‰ì„ ìœ„í•´)
                validJournalsSet = new Set(uniqueJournals);
                
                // í†µê³„ í‘œì‹œ
                displayStats(uniqueJournals);
                
                // ìƒ˜í”Œ í‘œì‹œ
                displayJournals(uniqueJournals.slice(0, 50));
                
                // ì½”ë“œ ìƒì„±
                generateCode(uniqueJournals);
                
            } catch (error) {
                console.error('Error:', error);
                document.querySelector('.info-box').innerHTML = `
                    <h2>âŒ ì˜¤ë¥˜ ë°œìƒ</h2>
                    <p>${error.message}</p>
                `;
            }
        }

        function displayStats(journals) {
            const stats = document.getElementById('stats');
            const dataSize = JSON.stringify(journals).length / 1024;
            
            stats.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${journals.length}</div>
                    <div>ì´ í•™ìˆ ì§€ ìˆ˜</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${dataSize.toFixed(1)} KB</div>
                    <div>ë°ì´í„° í¬ê¸°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${journals.filter(j => j.includes('êµ­ì–´') || j.includes('ë¬¸í•™')).length}</div>
                    <div>ë¬¸í•™ ê´€ë ¨ í•™ìˆ ì§€</div>
                </div>
            `;
            
            document.querySelector('.info-box').innerHTML = `
                <h2>âœ… ë¶„ì„ ì™„ë£Œ!</h2>
                <p>${journals.length}ê°œì˜ ë“±ì¬ í•™ìˆ ì§€ë¥¼ ë°œê²¬í–ˆìŠµë‹ˆë‹¤.</p>
                <p>ë°ì´í„° í¬ê¸°: ${dataSize.toFixed(1)}KB - NoHalluì— í¬í•¨í•˜ê¸° ì ì ˆí•œ í¬ê¸°ì…ë‹ˆë‹¤!</p>
            `;
        }

        function displayJournals(journals, searchTerm = '') {
            const list = document.getElementById('journalList');
            
            if (searchTerm) {
                list.innerHTML = `<strong>ê²€ìƒ‰ ê²°ê³¼ (${journals.length}ê°œ):</strong>\n\n`;
            } else {
                list.innerHTML = `<strong>í•™ìˆ ì§€ ëª©ë¡ ìƒ˜í”Œ (ì²˜ìŒ 50ê°œ):</strong>\n\n`;
            }
            
            journals.forEach((journal, index) => {
                list.innerHTML += `${index + 1}. ${journal}\n`;
            });
            
            if (!searchTerm && allJournals.length > 50) {
                list.innerHTML += `\n... ê·¸ ì™¸ ${allJournals.length - 50}ê°œ`;
            }
        }

        function searchJournals() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (!searchTerm) {
                displayJournals(allJournals.slice(0, 50));
                return;
            }
            
            const filtered = allJournals.filter(journal => 
                journal.toLowerCase().includes(searchTerm.toLowerCase())
            );
            
            displayJournals(filtered, searchTerm);
        }

        function generateCode(journals) {
            const codeOutput = document.getElementById('codeOutput');
            
            // ì••ì¶•ëœ í˜•íƒœë¡œ ì €ì¥ (ì²˜ìŒ 10ê°œë§Œ ë³´ì—¬ì£¼ê³  ë‚˜ë¨¸ì§€ëŠ” ...)
            const sampleJournals = journals.slice(0, 10);
            const remainingCount = journals.length - 10;
            
            const code = `// í•œêµ­ ë“±ì¬ í•™ìˆ ì§€ ëª©ë¡ (2025ë…„ 1ì›” ê¸°ì¤€, ì´ ${journals.length}ê°œ)
const validKoreanJournals = new Set([
${sampleJournals.map(j => `    "${j}"`).join(',\n')},
    // ... ê·¸ë¦¬ê³  ${remainingCount}ê°œ ë”
]);

// í•™ìˆ ì§€ ê²€ì¦ í•¨ìˆ˜
function isValidJournal(journalName) {
    // ì •ê·œí™”: ê³µë°± ì œê±°, ëŒ€ì†Œë¬¸ì í†µì¼
    const normalized = journalName.trim();
    return validKoreanJournals.has(normalized);
}

// NoHalluì— í†µí•©í•  ì½”ë“œ
function checkJournalValidity(citationInfo) {
    // í•™ìˆ ì§€ëª…ì´ ìˆëŠ” ê²½ìš° ê²€ì¦
    if (citationInfo.journal) {
        if (!isValidJournal(citationInfo.journal)) {
            citationInfo.suspicionLevel += 50;
            citationInfo.reasons.push("ë“±ì¬ë˜ì§€ ì•Šì€ í•™ìˆ ì§€");
            return true; // ê°€ì§œ ë°œê²¬!
        }
    }
    return false;
}

// ì „ì²´ ë°ì´í„°ëŠ” ë³„ë„ íŒŒì¼ë¡œ ì €ì¥í•˜ê±°ë‚˜ 
// ì•„ë˜ ì£¼ì„ì„ í•´ì œí•˜ì—¬ ì‚¬ìš©í•˜ì„¸ìš”:
/*
const validKoreanJournals = new Set(${JSON.stringify(journals)});
*/`;

            codeOutput.textContent = code;
        }

        function copyCode() {
            const codeOutput = document.getElementById('codeOutput');
            const textArea = document.createElement('textarea');
            textArea.value = codeOutput.textContent;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            
            alert('ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        loadJournalData();

        // Enter í‚¤ë¡œ ê²€ìƒ‰
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchJournals();
            }
        });
    </script>
</body>
</html>
